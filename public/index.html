<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SERVICES</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <style>
     body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #000000;
    }
    :root {
      --side-panel-hover-bg: #9a7506;
      --service-card-hover-bg: #85600b;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #3b2903;
      color: white;
      padding: 10px 20px;
      position: relative;
      margin: 10px;
    }
    .top-bar > .title {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      font-weight: bold;
      font-size: 20px;
    }
    .profile {
      position: relative;
    }
    .profile img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    .profile img:hover {
      transform: scale(1.1);
    }
    .profile-box {
      display: none;
      position: absolute;
      top: 50px;
      right: 0;
      background-color: #3b2903;
      color: white;
      padding: 10px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      width: 150px;
      text-align: center;
      font-size: 12px;
      transition: opacity 0.2s ease, transform 0.2s ease;
      opacity: 0;
      transform: translateY(-10px);
    }
    .profile:hover .profile-box {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }
    .profile-box img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      filter: brightness(1.2) contrast(1.1);
      margin-bottom: 5px;
    }
    .profile-box .user-name {
      font-size: 12px;
      margin-bottom: 8px;
    }
    .profile-box .logout-btn {
      background-color: #186409;
      border: none;
      color: white;
      padding: 5px 10px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 10px;
      width: 100%;
    }
    .profile-box .logout-btn:hover {
      background-color: #025002;
    }
    .second-bar {
      display: flex;
      align-items: center;
      background-color: #186409;
      color: white;
      padding: 10px 19px;
      margin: 10px;
      font-weight: bold;
    }
    .collapse-btn {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 20px;
    }
    .second-bar .left {
      width: 50px;
      padding: 10px 19px;
    }
    .second-bar .center {
      flex: 1;
      text-align: center;
      padding: 10px 19px;
      font-size: 20px;
      margin-right: 75px;
    }
    .container {
      display: flex;
      height: calc(100vh - 80px);
      margin: 10px;
      max-width: 99.1%;
    }
    .side-panel {
      width: 200px;
      background-color: #3b2903;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 20px;
      gap: 10px;
      transition: width 0.3s ease, opacity 0.3s ease;
      overflow: hidden;
      margin-right: 19px;
      margin-left: -10px;
    }
    .side-panel.hidden {
      width: 0;
      opacity: 0;
      pointer-events: none;
    }
    .side-panel button {
      display: flex;
      align-items: center;
      justify-content: center;
      background: none;
      border: 1px solid white;
      color: white;
      padding: 10px 20px;
      width: 80%;
      text-align: center;
      cursor: pointer;
      border-radius: 5px;
      gap: 8px;
      font-size: 9px;
    }
    .side-panel button:hover {
      background-color: var(--side-panel-hover-bg);
      font-size: 12px;
    }
    .side-panel-icon {
      font-size: 18px;
      line-height: 1;
      transition: font-size 0.2s ease;
    }
    .side-panel button:hover .side-panel-icon {
      font-size: 20px;
    }
    .side-panel-text {
      font-size: 12px;
      transition: font-size 0.2s ease;
      font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
    }
    .side-panel button:hover .side-panel-text {
      font-size: 17px;
    }
    .main-content {
      flex: 1;
      background-color: #025002;
      padding: 20px;
      overflow-y: auto;
      margin: 10px;
      margin-top: -1px;
      color: white;
      margin-right: 1px;
      margin-left: -9.5px;
      margin-bottom: -1px;
      font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
      scrollbar-width: none;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .service-card {
      background-color: #3b2903;
      border: 1px solid #bbb;
      border-radius: 10px;
      padding: 20px 10px;
      text-align: center;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s ease, background-color 0.2s ease, font-size 0.2s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    .service-card:hover {
      transform: scale(1.03);
      background-color: var(--service-card-hover-bg);
      font-size: large;
    }
    .service-icon {
      font-size: 30px;
      line-height: 1;
      transition: font-size 0.2s ease;
    }
    .service-card:hover .service-icon {
      font-size: 34px;
    }
    .service-name {
      font-size: 14px;
      transition: font-size 0.2s ease;
    }
    .service-card:hover .service-name {
      font-size: 16px;
    }
    .profile-content {
      text-align: center;
      padding: 20px;
    }
    .profile-content img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      filter: brightness(1.2) contrast(1.1);
      margin-bottom: 15px;
    }
    .profile-content .user-name {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 15px;
    }
    .profile-content .logout-btn {
      background-color: #186409;
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }
    .profile-content .logout-btn:hover {
      background-color: #025002;
    }
    .color-picker-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-top: 20px;
    }
    .color-picker-container label {
      font-weight: bold;
    }
    .reset-btn {
      background-color: #e0e0e0;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      font-weight: bold;
      border-radius: 5px;
      margin-top: 20px;
    }
    .style-control {
      margin-bottom: 15px;
    }
    .style-control label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    .style-control select,
    .style-control input[type="text"],
    .style-control input[type="file"] {
      width: 100%;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    .color-input-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .color-input-group input[type="color"] {
      width: 50px;
      height: 30px;
      padding: 0;
      border: 1px solid #ddd;
    }
    .color-input-group input[type="text"] {
      flex: 1;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    .logo-preview {
      max-width: 200px;
      max-height: 100px;
      margin: 20px 0;
      display: block;
    }
    @media (max-width: 568px) {
      .container {
        flex-direction: column;
        max-width: auto;
      }
      .top-bar > .title {
        font-size: 14px;
      }
      .second-bar .center {
        font-size: 14px;
      }
      .second-bar .left {
        width: 40px;
        padding: 10px 10px;
      }
      .second-bar .center {
        margin-right: 50px;
      }
      .collapse-btn {
        font-size: 18px;
      }
      .side-panel {
        flex-direction: row;
        width: 100%;
        height: auto;
        padding: 10px 19px;
        margin: 10px;
        overflow-x: auto;
        white-space: nowrap;
        transition: height 0.3s ease, opacity 0.3s ease;
        scrollbar-width: none;
        -webkit-overflow-scrolling: touch;
        margin-top: 2px;
        margin-bottom: 2px;
        margin-right: -60px;
        margin-left: -10px;
        margin-right: 22px;
        font-size: 20px;
      }
      .side-panel::-webkit-scrollbar {
        display: none;
      }
      .side-panel.hidden {
        height: 0;
        padding: 0;
        margin: 0;
        opacity: 0;
        pointer-events: none;
      }
      .side-panel button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        flex: none;
        width: auto;
        margin: 0 5px;
        padding: 10px 15px;
        border: 1px solid white;
        border-radius: 5px;
        white-space: nowrap;
        font-size: 20px;
        display: grid;
        transition: transform 0.2s ease, background-color 0.2s ease, font-size 0.2s ease;
      }
      .side-panel-icon {
        font-size: 16px;
      }
      .side-panel button:hover .side-panel-icon {
        font-size: 18px;
      }
      .side-panel-text {
        font-size: 10px;
      }
      .side-panel button:hover .side-panel-text {
        font-size: 11px;
      }
      .main-content {
        margin: 0;
        margin-top: 10px;
        margin-bottom: 10px;
        overflow-y: auto;
        scrollbar-width: none;
        -webkit-overflow-scrolling: touch;
        padding: 10px 19px;
        margin-right: 10px;
        margin-left: -9px;
      }
      .main-content::-webkit-scrollbar {
        display: none;
      }
      .side-panel.hidden + .main-content {
        margin-top: 0;
      }
      .profile-box {
        width: 120px;
        font-size: 10px;
      }
      .profile-box img {
        width: 50px;
        height: 50px;
      }
      .profile-box .user-name {
        font-size: 10px;
      }
      .profile-box .logout-btn {
        font-size: 8px;
        padding: 4px 8px;
      }
      .profile-content img {
        width: 100px;
        height: 100px;
      }
      .profile-content .user-name {
        font-size: 20px;
      }
      .profile-content .logout-btn {
        font-size: 14px;
        padding: 8px 16px;
      }
    }
  </style>
</head>
<body>
  <div class="top-bar" id="topBar">
    <div></div>
    <div class="title">TOP BAR</div>
    <div class="profile">
      <img src="Caleb.jpg" id="profileLogo" />
      <div class="profile-box">
        <img src="Caleb.jpg" id="profileBoxLogo" />
        <div class="user-name" id="profileBoxName"></div>
        <button class="logout-btn" onclick="logout()">Log Out</button>
      </div>
    </div>
  </div>

  <div class="second-bar" id="secondBar">
    <div class="left">
      <button class="collapse-btn" onclick="toggleSidePanel()">☰</button>
    </div>
    <div class="center">CHOOSE YOUR SERVICE</div>
  </div>

  <div class="container">
    <div class="side-panel" id="sidePanel">
      <button onclick="showPage('home')"><span class="side-panel-icon">🏠</span><span class="side-panel-text">HOME</span></button>
      <button onclick="showPage('info')"><span class="side-panel-icon">ℹ️</span><span class="side-panel-text">INFO</span></button>
      <button onclick="showPage('contacts')"><span class="side-panel-icon">📞</span><span class="side-panel-text">CONTACTS</span></button>
      <button onclick="showPage('profile')"><span class="side-panel-icon">👤</span><span class="side-panel-text">PROFILE</span></button>
    </div>

    <div class="main-content" id="mainContent">
      Select a page to display content here.
    </div>
  </div>

  <script>

    
    const services = [
      'HUMAN RESOURCE', 'FINANCE', 'PAYROLL',
      'APPROVALS', 'PROJECTS', 'PROCUREMENT', 'IT',
      'INVENTORY', 'MARKETING', 'SUPPORT', 'TRAINING'
    ];

    const serviceIcons = {
      'HUMAN RESOURCE': '👥',
      'FINANCE': '💰',
      'ADMINISTRATION': '📋',
      'PAYROLL': '💸',
      'APPROVALS': '✅',
      'PROJECTS': '📅',
      'PROCUREMENT': '🛒',
      'IT': '💻',
      'INVENTORY': '📦',
      'MARKETING': '📣',
      'SUPPORT': '🛠️',
      'TRAINING': '🎓'
    };

    const sidePanelIcons = {
      'HOME': '🏠',
      'INFO': 'ℹ️',
      'CONTACTS': '📞',
      'PROFILE': '👤',
      'TOP BAR': '📌',
      'SECOND BAR': '📊',
      'SIDE PANEL': '📑',
      'MAIN PANEL': '📄',
      'LOGO': '🖼️'
    };

    const apiService = {
      getServices: async () => {
        const token = localStorage.getItem("token");
        const response = await fetch('http://localhost:5000/api/users/me', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (!response.ok) {
          throw new Error('Not authenticated');
        }
        
        const user = await response.json();
        let userServices = services;
        
        if (user.role === "admin") {
          userServices = [...services, 'ADMINISTRATION'];
        }
        
        return userServices.map(name => ({ name }));
      },

      loadPreferences: async () => {
        try {
          const prefs = localStorage.getItem('uiPreferences');
          console.log('Loading preferences:', prefs);
          return prefs ? JSON.parse(prefs) : null;
        } catch (error) {
          console.error('Error loading preferences:', error);
          return null;
        }
      },

      savePreferences: async (preferences) => {
        try {
          console.log('Saving preferences:', preferences);
          localStorage.setItem('uiPreferences', JSON.stringify(preferences));
          return true;
        } catch (error) {
          console.error('Error saving preferences:', error);
          return false;
        }
      }
    };

    const defaultStyles = {
      topBar: { 
        background: '#3b2903', 
        color: 'white',
        buttonBackground: '#3b2903',
        buttonColor: 'white',
        fontFamily: 'Arial, sans-serif',
        text: 'TOP BAR'
      },
      secondBar: { 
        background: '#186409', 
        color: 'white',
        buttonBackground: '#186409',
        buttonColor: 'white',
        fontFamily: 'Arial, sans-serif',
        text: 'SECOND BAR'
      },
      sidePanel: { 
        background: '#3b2903',
        color: 'white',
        buttonBackground: '#3b2903',
        buttonColor: 'white',
        fontFamily: 'Arial, sans-serif',
        hoverBackground: '#9a7506'
      },
      mainContent: { 
        background: '#025002',
        color: 'white',
        buttonBackground: '#3b2903',
        buttonColor: 'white',
        fontFamily: "'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif",
        serviceCardHoverBackground: '#85600b'
      },
      logo: {
        src: 'Caleb.jpg',
        width: '40px',
        borderRadius: '50%'
      }
    };

    let currentStyles = { ...defaultStyles };

    let currentUser = null;

    window.onload = async () => {
      const token = localStorage.getItem("token");
      if (!token) {
        window.location.href = "login.html";
        return;
      }

      try {
        const response = await fetch('http://localhost:5000/api/users/me', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (!response.ok) {
          throw new Error('Not authenticated');
        }
        
        currentUser = await response.json();
        
        const savedPrefs = await apiService.loadPreferences();
        if (savedPrefs) {
          console.log('Loaded saved preferences:', savedPrefs);
          currentStyles = { ...defaultStyles, ...savedPrefs };
          Object.keys(currentStyles).forEach(area => {
            if (area !== 'logo') {
              applyStylesToArea(area, currentStyles[area]);
            }
          });
        }
        showPage('home');
      } catch (error) {
        console.error('Error during initialization:', error);
        window.location.href = "login.html";
      }
    };

    function toggleSidePanel() {
      const sidePanel = document.getElementById('sidePanel');
      sidePanel.classList.toggle('hidden');
    }

    function logout() {
      localStorage.removeItem("currentUser");
      window.location.href = "login.html";
    }

    async function showPage(page) {
      console.log('Showing page:', page);
      const mainContent = document.getElementById('mainContent');
      const sidePanel = document.getElementById('sidePanel');

      if (currentUser) {
        if (currentUser.role === "admin") {
          sidePanel.innerHTML = `
            <button onclick="showPage('home')"><span class="side-panel-icon">🏠</span><span class="side-panel-text">HOME</span></button>
            <button onclick="showPage('info')"><span class="side-panel-icon">ℹ️</span><span class="side-panel-text">INFO</span></button>
            <button onclick="showPage('contacts')"><span class="side-panel-icon">📞</span><span class="side-panel-text">CONTACTS</span></button>
            <button onclick="showPage('profile')"><span class="side-panel-icon">👤</span><span class="side-panel-text">PROFILE</span></button>
            <button onclick="showPage('ADMINISTRATION')"><span class="side-panel-icon">📋</span><span class="side-panel-text">ADMIN</span></button>
          `;
        } else {
          sidePanel.innerHTML = `
            <button onclick="showPage('home')"><span class="side-panel-icon">🏠</span><span class="side-panel-text">HOME</span></button>
            <button onclick="showPage('info')"><span class="side-panel-icon">ℹ️</span><span class="side-panel-text">INFO</span></button>
            <button onclick="showPage('contacts')"><span class="side-panel-icon">📞</span><span class="side-panel-text">CONTACTS</span></button>
            <button onclick="showPage('profile')"><span class="side-panel-icon">👤</span><span class="side-panel-text">PROFILE</span></button>
          `;
        }

        // Always reapply side panel styles after modifying the buttons
        if (currentStyles.sidePanel) {
          console.log('Reapplying side panel styles:', currentStyles.sidePanel);
          applyStylesToArea('sidePanel', currentStyles.sidePanel);
        }
      }

      if (page === "home") {
        try {
          const services = await apiService.getServices();
          let html = '<div class="grid">';
          services.forEach((service, index) => {
            const icon = serviceIcons[service.name] || '❓';
            html += `
              <div class="service-card" id="service-${index}" onclick="showPage('${service.name}')">
                <span class="service-icon">${icon}</span>
                <span class="service-name">${service.name}</span>
              </div>
            `;
          });
          html += '</div>';
          mainContent.innerHTML = html;

          if (currentStyles.mainContent) {
            console.log('Reapplying main content styles:', currentStyles.mainContent);
            applyStylesToArea('mainContent', currentStyles.mainContent);
          }
        } catch (error) {
          console.error('Error loading services:', error);
          mainContent.innerHTML = '<p>Error loading services. Please try again later.</p>';
        }
      } else if (page === "FINANCE") {
        mainContent.innerHTML = `
          <h2>Finance Section</h2>
          <p>View financial reports, budgets, and transactions here.</p>
          <ul>
            <li>Budget Overview</li>
            <li>Transaction Logs</li>
            <li>Expenditure Reports</li>
          </ul>
        `;
      } else if (page === "HUMAN RESOURCE") {
        mainContent.innerHTML = `
          <h2>Human Resource</h2>
          <p>Manage employee profiles, attendance, and recruitment.</p>
          <ul>
            <li>Employee Directory</li>
            <li>Leave Applications</li>
            <li>Recruitment Tracker</li>
          </ul>
        `;
      } else if (page === "profile") {
        mainContent.innerHTML = `
          <div class="profile-content">
            <img src="${currentStyles.logo.src}" />
            <div class="user-name">${currentUser.name || 'User'}</div>
            <button class="logout-btn" onclick="logout()">Log Out</button>
          </div>
        `;
      } else if (page === "ADMINISTRATION") {
        if (currentUser.role !== "admin") {
          mainContent.innerHTML = `<h2>Access Denied</h2><p>You do not have permission to access this section.</p>`;
          return;
        }
        sidePanel.innerHTML = `
          <button onclick="showPage('home')"><span class="side-panel-icon">${sidePanelIcons['HOME']}</span><span class="side-panel-text">HOME</span></button>
          <button onclick="showCustomizationPage('topBar')"><span class="side-panel-icon">${sidePanelIcons['TOP BAR']}</span><span class="side-panel-text">TOP BAR</span></button>
          <button onclick="showCustomizationPage('secondBar')"><span class="side-panel-icon">${sidePanelIcons['SECOND BAR']}</span><span class="side-panel-text">SECOND BAR</span></button>
          <button onclick="showCustomizationPage('sidePanel')"><span class="side-panel-icon">${sidePanelIcons['SIDE PANEL']}</span><span class="side-panel-text">SIDE PANEL</span></button>
          <button onclick="showCustomizationPage('mainContent')"><span class="side-panel-icon">${sidePanelIcons['MAIN PANEL']}</span><span class="side-panel-text">MAIN PANEL</span></button>
          <button onclick="showLogoCustomizationPage()"><span class="side-panel-icon">${sidePanelIcons['LOGO']}</span><span class="side-panel-text">LOGO</span></button>
        `;
        
        // Reapply side panel styles after modifying the admin buttons
        if (currentStyles.sidePanel) {
          console.log('Reapplying side panel styles for admin page:', currentStyles.sidePanel);
          applyStylesToArea('sidePanel', currentStyles.sidePanel);
        }
        
        mainContent.innerHTML = `
          <h2>Administration Panel</h2>
          <p>Select an area from the side panel to customize its appearance.</p>
        `;
      } else {
        mainContent.innerHTML = `<h2>${page}</h2><p>Welcome to the ${page} section.</p>`;
      }
    }

    function showCustomizationPage(area) {
      const mainContent = document.getElementById('mainContent');
      const styles = currentStyles[area];
      
      let html = `
        <h2>Customize ${area.replace(/([A-Z])/g, ' $1')}</h2>
        <div class="style-control">
          <label>Background Color:</label>
          <div class="color-input-group">
            <input type="color" id="${area}-background" value="${styles.background}" />
            <input type="text" id="${area}-background-hex" value="${styles.background}" placeholder="Hex code" />
          </div>
        </div>
        
        <div class="style-control">
          <label>Text Color:</label>
          <div class="color-input-group">
            <input type="color" id="${area}-color" value="${styles.color}" />
            <input type="text" id="${area}-color-hex" value="${styles.color}" placeholder="Hex code" />
          </div>
        </div>

        <div class="style-control">
          <label>Button Background Color:</label>
          <div class="color-input-group">
            <input type="color" id="${area}-button-background" value="${styles.buttonBackground || '#3b2903'}" />
            <input type="text" id="${area}-button-background-hex" value="${styles.buttonBackground || '#3b2903'}" placeholder="Hex code" />
          </div>
        </div>

        <div class="style-control">
          <label>Button Text Color:</label>
          <div class="color-input-group">
            <input type="color" id="${area}-button-color" value="${styles.buttonColor || '#ffffff'}" />
            <input type="text" id="${area}-button-color-hex" value="${styles.buttonColor || '#ffffff'}" placeholder="Hex code" />
          </div>
        </div>
        
        <div class="style-control">
          <label for="${area}-font">Font Family:</label>
          <select id="${area}-font">
            <option value="Arial, sans-serif" ${styles.fontFamily === 'Arial, sans-serif' ? 'selected' : ''}>Arial</option>
            <option value="Verdana, sans-serif" ${styles.fontFamily === 'Verdana, sans-serif' ? 'selected' : ''}>Verdana</option>
            <option value="Georgia, serif" ${styles.fontFamily === 'Georgia, serif' ? 'selected' : ''}>Georgia</option>
            <option value="'Times New Roman', serif" ${styles.fontFamily === "'Times New Roman', serif" ? 'selected' : ''}>Times New Roman</option>
            <option value="'Courier New', monospace" ${styles.fontFamily === "'Courier New', monospace" ? 'selected' : ''}>Courier New</option>
            <option value="'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif" ${styles.fontFamily === "'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif" ? 'selected' : ''}>Franklin Gothic Medium</option>
          </select>
        </div>`;

      if (area === 'topBar' || area === 'secondBar') {
        html += `
          <div class="style-control">
            <label for="${area}-text">Text:</label>
            <input type="text" id="${area}-text" value="${styles.text}" placeholder="Enter text" />
          </div>
        `;
      }

      if (area === 'sidePanel') {
        html += `
          <div class="style-control">
            <label>Hover Background Color:</label>
            <div class="color-input-group">
              <input type="color" id="${area}-hover-background" value="${styles.hoverBackground || '#9a7506'}" />
              <input type="text" id="${area}-hover-background-hex" value="${styles.hoverBackground || '#9a7506'}" placeholder="Hex code" />
            </div>
          </div>
        `;
      }

      if (area === 'mainContent') {
        html += `
          <div class="style-control">
            <label>Service Card Hover Background Color:</label>
            <div class="color-input-group">
              <input type="color" id="${area}-service-card-hover-background" value="${styles.serviceCardHoverBackground || '#85600b'}" />
              <input type="text" id="${area}-service-card-hover-background-hex" value="${styles.serviceCardHoverBackground || '#85600b'}" placeholder="Hex code" />
            </div>
          </div>
        `;
      }

      html += `
        <button class="reset-btn" onclick="resetAreaStyles('${area}')">Reset to Default</button>
        <button class="reset-btn" onclick="applyAreaStyles('${area}')">Apply Styles</button>
      `;

      mainContent.innerHTML = html;

      setupColorSync(`${area}-background`, `${area}-background-hex`);
      setupColorSync(`${area}-color`, `${area}-color-hex`);
      setupColorSync(`${area}-button-background`, `${area}-button-background-hex`);
      setupColorSync(`${area}-button-color`, `${area}-button-color-hex`);
      if (area === 'sidePanel') {
        setupColorSync(`${area}-hover-background`, `${area}-hover-background-hex`);
      }
      if (area === 'mainContent') {
        setupColorSync(`${area}-service-card-hover-background`, `${area}-service-card-hover-background-hex`);
      }
    }

    function setupColorSync(pickerId, hexId) {
      const picker = document.getElementById(pickerId);
      const hexInput = document.getElementById(hexId);

      picker.addEventListener('input', () => {
        hexInput.value = picker.value;
      });

      hexInput.addEventListener('input', () => {
        if (/^#[0-9A-F]{6}$/i.test(hexInput.value)) {
          picker.value = hexInput.value;
        }
      });
    }

    function showLogoCustomizationPage() {
      const mainContent = document.getElementById('mainContent');
      const logo = currentStyles.logo;
      
      mainContent.innerHTML = `
        <h2>Logo Customization</h2>
        <div class="style-control">
          <label for="logo-src">Logo Image:</label>
          <input type="file" id="logo-src" accept="image/*" />
          <small>Current: ${logo.src}</small>
          <img src="${logo.src}" class="logo-preview" id="logo-preview" />
        </div>
        <div class="style-control">
          <label for="logo-width">Width:</label>
          <input type="text" id="logo-width" value="${logo.width}" placeholder="e.g. 40px" />
        </div>
        <div class="style-control">
          <label for="logo-border-radius">Border Radius:</label>
          <input type="text" id="logo-border-radius" value="${logo.borderRadius}" placeholder="e.g. 50%" />
        </div>
        <button class="reset-btn" onclick="resetLogoStyles()">Reset to Default</button>
        <button class="reset-btn" onclick="applyLogoStyles()">Apply Logo Styles</button>
      `;
      
      document.getElementById('logo-src').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function(event) {
            document.getElementById('logo-preview').src = event.target.result;
            document.getElementById('profileLogo').src = event.target.result;
            document.getElementById('profileBoxLogo').src = event.target.result;
          };
          reader.readAsDataURL(file);
        }
      });
    }

    async function applyAreaStyles(area, directStyles = null) {
      const styles = directStyles || {
        background: document.getElementById(`${area}-background`).value,
        color: document.getElementById(`${area}-color`).value,
        buttonBackground: document.getElementById(`${area}-button-background`).value,
        buttonColor: document.getElementById(`${area}-button-color`).value,
        fontFamily: document.getElementById(`${area}-font`).value,
        text: document.getElementById(`${area}-text`)?.value,
        hoverBackground: document.getElementById(`${area}-hover-background`)?.value,
        serviceCardHoverBackground: document.getElementById(`${area}-service-card-hover-background`)?.value
      };
      
      console.log('Applying styles for', area, ':', styles);
      currentStyles[area] = { ...currentStyles[area], ...styles };
      await apiService.savePreferences(currentStyles);
      
      applyStylesToArea(area, styles);
    }

    function applyStylesToArea(area, styles) {
      const element = document.getElementById(area === 'mainContent' ? 'mainContent' : area);
      if (element) {
        element.style.backgroundColor = styles.background;
        element.style.color = styles.color;
        element.style.fontFamily = styles.fontFamily;
      }

      if (area === 'topBar') {
        const titleElement = document.querySelector('.top-bar .title');
        if (titleElement) {
          titleElement.style.color = styles.color;
          titleElement.style.fontFamily = styles.fontFamily;
          titleElement.textContent = styles.text;
        }
      }

      if (area === 'secondBar') {
        const centerElement = document.querySelector('.second-bar .center');
        if (centerElement) {
          centerElement.style.color = styles.color;
          centerElement.style.fontFamily = styles.fontFamily;
          centerElement.textContent = styles.text;
        }
      }

      if (area === 'sidePanel') {
        document.querySelectorAll('.side-panel button').forEach(button => {
          button.style.color = styles.buttonColor || styles.color;
          button.style.backgroundColor = styles.buttonBackground || styles.background;
          button.style.fontFamily = styles.fontFamily;
          button.style.borderColor = styles.buttonColor || styles.color;
        });
        document.documentElement.style.setProperty('--side-panel-hover-bg', styles.hoverBackground || '#9a7506');
      }

      if (area === 'mainContent') {
        document.querySelectorAll('.service-card').forEach(card => {
          card.style.color = styles.buttonColor || styles.color;
          card.style.backgroundColor = styles.buttonBackground || styles.background;
        });
        document.documentElement.style.setProperty('--service-card-hover-bg', styles.serviceCardHoverBackground || '#85600b');
      }
    }

    async function applyLogoStyles() {
      const logo = document.getElementById('profileLogo');
      const boxLogo = document.getElementById('profileBoxLogo');
      const fileInput = document.getElementById('logo-src');
      const width = document.getElementById('logo-width').value;
      const borderRadius = document.getElementById('logo-border-radius').value;
      
      if (fileInput.files && fileInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          logo.src = e.target.result;
          boxLogo.src = e.target.result;
          currentStyles.logo.src = e.target.result;
        };
        reader.readAsDataURL(fileInput.files[0]);
      }
      
      logo.style.width = width;
      logo.style.borderRadius = borderRadius;
      currentStyles.logo.width = width;
      currentStyles.logo.borderRadius = borderRadius;
      
      await apiService.savePreferences(currentStyles);
    }

    function resetAreaStyles(area) {
      const defaults = {
        topBar: { 
          background: '#3b2903', 
          color: 'white',
          buttonBackground: '#3b2903',
          buttonColor: 'white',
          fontFamily: 'Arial, sans-serif',
          text: 'TOP BAR'
        },
        secondBar: { 
          background: '#186409', 
          color: 'white',
          buttonBackground: '#186409',
          buttonColor: 'white',
          fontFamily: 'Arial, sans-serif',
          text: 'SECOND BAR'
        },
        sidePanel: { 
          background: '#3b2903',
          color: 'white',
          buttonBackground: '#3b2903',
          buttonColor: 'white',
          fontFamily: 'Arial, sans-serif',
          hoverBackground: '#9a7506'
        },
        mainContent: { 
          background: '#025002',
          color: 'white',
          buttonBackground: '#3b2903',
          buttonColor: 'white',
          fontFamily: "'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif",
          serviceCardHoverBackground: '#85600b'
        }
      };
      
      currentStyles[area] = { ...defaults[area] };
      showCustomizationPage(area);
      applyAreaStyles(area, defaults[area]);
    }

    function resetLogoStyles() {
      const defaults = {
        src: 'Caleb.jpg',
        width: '40px',
        borderRadius: '50%'
      };
      
      currentStyles.logo = { ...defaults };
      const logo = document.getElementById('profileLogo');
      const boxLogo = document.getElementById('profileBoxLogo');
      logo.src = defaults.src;
      boxLogo.src = defaults.src;
      logo.style.width = defaults.width;
      logo.style.borderRadius = defaults.borderRadius;
      showLogoCustomizationPage();
    }

    function applyStylesFromCurrent() {
      Object.keys(currentStyles).forEach(area => {
        if (area !== 'logo') {
          const styles = currentStyles[area];
          const element = document.getElementById(area === 'mainContent' ? 'mainContent' : area);
          if (element) {
            element.style.backgroundColor = styles.background;
            element.style.color = styles.color;
            element.style.fontFamily = styles.fontFamily;
          }
          if (area === 'topBar') {
            const titleElement = document.querySelector('.top-bar .title');
            titleElement.textContent = styles.text;
            titleElement.style.color = styles.color;
            titleElement.style.fontFamily = styles.fontFamily;
          }
          if (area === 'secondBar') {
            const centerElement = document.querySelector('.second-bar .center');
            centerElement.textContent = styles.text;
            centerElement.style.color = styles.color;
            centerElement.style.fontFamily = styles.fontFamily;
          }
          if (area === 'sidePanel') {
            document.querySelectorAll('.side-panel button').forEach(button => {
              button.style.color = styles.buttonColor || styles.color;
              button.style.backgroundColor = styles.buttonBackground || styles.background;
              button.style.fontFamily = styles.fontFamily;
              button.style.borderColor = styles.buttonColor || styles.color;
            });
            document.documentElement.style.setProperty('--side-panel-hover-bg', styles.hoverBackground || '#9a7506');
          }
          if (area === 'mainContent') {
            document.querySelectorAll('.service-card').forEach(card => {
              card.style.color = styles.buttonColor || styles.color;
              card.style.backgroundColor = styles.buttonBackground || styles.background;
            });
            document.documentElement.style.setProperty('--service-card-hover-bg', styles.serviceCardHoverBackground || '#85600b');
          }
        }
      });
      
      const logo = document.getElementById('profileLogo');
      const boxLogo = document.getElementById('profileBoxLogo');
      if (logo && boxLogo && currentStyles.logo) {
        logo.src = currentStyles.logo.src;
        boxLogo.src = currentStyles.logo.src;
        logo.style.width = currentStyles.logo.width;
        logo.style.borderRadius = currentStyles.logo.borderRadius;
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html> 